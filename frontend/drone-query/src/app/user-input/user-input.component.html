<mat-card class="input-card">
  <mat-card-header>
    <mat-card-title>User Input</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="input-container">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Enter your query</mat-label>
        <input matInput [(ngModel)]="userInput" (keydown)="handleKeyDown($event)">
      </mat-form-field>
      <button mat-raised-button (click)="submitQuery()" [disabled]="isLoading" class="submit-button">Submit</button>
    </div>

    <div *ngIf="isLoading" class="spinner-container">
      <mat-spinner></mat-spinner>
    </div>

    <!-- Only show percentage or direct response if there is no table data -->
    <div *ngIf="!dataSource.data.length">
      <div *ngIf="percentageResponse" class="response-card">
        <p>Percentage Response: {{ percentageResponse }}</p>
      </div>
      <div *ngIf="directResponse && !percentageResponse" class="response-card">
        <p>Direct Response: {{ directResponse }}</p>
      </div>
    </div>

    <div *ngIf="dataSource.data.length > 0" class="sort-instruction">
      <p>Click on the column headers to sort the table.</p>
    </div>

    <mat-table [dataSource]="dataSource" class="mat-elevation-z8" *ngIf="dataSource.data.length > 0">
      <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
        <mat-header-cell *matHeaderCellDef (click)="sortData(column)" class="sortable-header">
          {{ column | titlecase }}
        </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element[column] ?? 'N/A' }} <!-- Display 'N/A' for null or undefined -->
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <!-- Sorting Info -->
    <div *ngIf="currentSort.column" class="sort-info">
      <p>{{ currentSort.direction === 'asc' ? 'Ascending' : 'Descending' }} by: {{ currentSort.column | titlecase }}</p>
      <button mat-button (click)="resetSort()">Reset Sort</button>
    </div>
  </mat-card-content>
</mat-card>
